\documentclass[pra,
aps,
twocolumn,
superscriptaddress,
groupedaddress,
nofootinbib,
reprint
]{revtex4-1}

\input{preamble}

\begin{document}

\begin{abstract}
\ddd{[To be sharpened]} Magic states are key ingredients in schemes to realise universal fault-tolerant quantum computation.
Theories of magic states attempt to quantify this computational element via monotones and determine how these states may be efficiently transformed into useful forms. Here we introduce the concept of `fragments', which generalise the concept of magic monotones and has a natural thermodynamic structure based on majorisation. From this perspective magic can be viewed as a form of free energy within each fragment and is constrained by relative majorisation relations but now on quasi-probability distributions. Notably this approach allows us to incorporate actual physical constraints, for example noise models with particular bias or temperature-dependent features, and study how these constrain general magic distillation protocols. In this context we present general temperature-dependent bounds on distillation rates that any theory of magic must respect. Significantly, this analysis also presents a thermodynamic context which cannot be analysed via traditional methods based on thermodynamic entropies, due to the presence of negativity, and raises novel questions in the context of statistical mechanics.
\end{abstract}

\preprint{APS/123-QED}

\title{Thermodynamic fragments for magic states in quantum computation}

\author{Nikolaos Koukoulekidis}
	\email{nk2314@imperial.ac.uk}
	\affiliation{Department of Physics, Imperial College London, London SW7 2AZ, UK}
\author{David Jennings}
	\affiliation{School of Physics and Astronomy, University of Leeds, Leeds, LS2 9JT, UK}
	\affiliation{Department of Physics, Imperial College London, London SW7 2AZ, UK}

\date{\today}
\maketitle

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Introduction and background}
\label{sec:intro_prev}

\begin{enumerate}
    \item Fault-tolerance~\cite{cit:raussendorf, cit:gross2, cit:markov, cit:gross, cit:nest, cit:nest2, cit:vidal, cit:fujii, cit:gottesman}
    \item Magic~\cite{cit:veitch, cit:veitch2, cit:wang, cit:wang2, cit:howard, cit:campbell, cit:gross3, cit:gross4}
    \item Bringing in majorisation~\cite{cit:cwiklinski, cit:lostaglio2, cit:lostaglio, cit:gour, cit:janzing, cit:brandao2, cit:gour2, cit:marshall, cit:nielsen}
\end{enumerate}

\subsection{Introduction}
\label{sec:intro}

Magic states are necessary for achieving universal quantum computation within fault-tolerant schemes.
Identifying magic as a resource for quantum universality has led to several theories which try to provide a framework for its quantification and manipulation \nick{CITE}.
The main question that such a theory attempts to answer is:
\begin{center}
    \emph{Given two magic states $\rho$ and $\rho'$ is there a free operation that can convert $\rho$ to $\rho'$?}
\end{center}

We are interested in all resource theories of magic $\R = (\F, \O)$ in which free operations cannot generate any amount of resource. 
Further denote by $\D$ the set of states considered under the theory, that is the union of free and resource states.
The structure of such theory is described by a partial order \nick{CITE}, hereinafter called a \emph{pre-order}, $\prec_{\R}$ between states.
We write $\rho' \prec_{\R} \rho$ iff there exists $\E \in \O$ such that $\E(\rho) = \rho'$.
Naturally, states may be incomparable under the given theory, meaning that there exists no free operation that converts one to the other.
We further call $\R' = (\F', \O')$ a \emph{subtheory} of $\R$ iff $\F' \subseteq \F$ and $\O' \subseteq \O$. 
The above notation will be used for general resource theories as well.

Formally, the no resource generation condition on the theories translates into two assumptions:
\begin{enumerate}[I]
    \item Free operations send free states into free states, $\E: \F \mapsto \F$, for all $\E \in \O$;
    \item Resource theory $\R$ is a completely free state preserving theory, in the sense that for any $d$-dimensional ancilla system and all free operations $\E$, $(\id_d \otimes \E ) \sigma \in \F$ whenever $\sigma \in \F$.
\end{enumerate}
The first assumption simply states that resources cannot be generated for free and is a minimal requirement for a resource theory. 
An immediate consequence is that if statistical mixing is included in $\O$, then the resource theory is convex.
Convex resource theories have attracted a lot of attention recently \nick{CITE} and include the magic theories discussed in~\cref{sec:prev}.
The second assumption implies that resources cannot be generated even when ancillas are allowed \nick{example of T state generation on Bell state by Campbell}.

Monotones are often used \nick{CITE} to address the question of state convertibility, although such approaches are usually generic.

The monotonicity condition reflects the no resource generating property of free operations, so that monotones respect the pre-order $\prec_\R$ of the theory.
A monotone of any general resource theory is a projection of the theory onto the non-negative real numbers, collapsing the pre-order of the theory to the total order defined on the real line.
Our contribution is the introduction of a generalised notion of \emph{resource projection} which maps a general resource theory onto a subtheory which in principle still retains a partial structure (as opposed to the real line).
Applying this notion on existing magic theories highlights the hidden stochasticity that governs magic state conversions.
We show that a magic theory can be subdivided into \emph{fragments} \nick{expand}

\subsection{Previous work}
\label{sec:prev}

\ddd{[Section needs a lot of fixing]}

The stabiliser theory of magic comprises of the so-called ``stabiliser'' states ($\stab$) and operations ($\so$), while non-stabiliser (resource) states are called magic.
The stabiliser operations can be expressed in terms of a Stinespring dilation as 
\begin{equation}
    \E(\rho) = \tr_E [U(\rho \otimes \sigma_E)U^\dagger],
\end{equation} 
for an ancilla stabiliser state $\sigma_E$. 
The motivation of the theory stems from the fact that stabiliser operations are experimentally straightforward to implement and they can be used to detect and correct errors on the stabiliser states due to their construction \nick{CITE}.
The Gottesman-Knill theorem however indicates that stabiliser operations need to be supplemented with magic states in order to achieve universality, justifying the term ``magic''.

Generalisations of the stabiliser theory appear in the literature intending to include broader classes of operations \nick{CITE}.
The class of stabiliser preserving operations ($\spo$) is defined as the set of $\cptp$ maps that send stabiliser states into stabiliser states~\cite{cit:ahmadi}.
An important subclass of $\spo$ is the set of completely stabiliser preserving operations ($\cspo$), which intuitively cannot induce ``non-stabiliserness'' even when applied to only part of a quantum state, i.e. operations $\E$ such that $(\id_d \otimes \E ) \sigma \in \stab$ for all positive dimensions $d$ whenever $\sigma \in \stab$.

Even though non-stabiliserness is a necessary resource for universality, it has been proven insufficient for magic state distillation~\cite{cit:bravyi, cit:campbell}.
In fact, all states with non-negative Wigner distributions have been proven to be efficiently classically simulable in~\cite{cit:mari}, a result that serves as a generalization of the Gottesman-Knill theorem.
The Wigner distribution of a state in odd prime dimensions is discussed rigorously in~\cref{sec:wigner} and arises as the unique quasi-probability representation of quantum theory that identifies non-contextuality exactly with the states that are efficiently classically simulable~\cite{cit:howard2, cit:veitch2}.
In this framework, the stabiliser states are the only pure states represented with non-negative distributions~\cite{cit:gross3}. 
However, there exist mixed states with non-negative Wigner distributions that are not mixtures of stabiliser states~\cite{cit:gross}.
Therefore, stabiliser-preserving theories have been extended to a theory that preserves state ``Wigner positivity''~\cite{cit:wang}, formally defined in~\cref{sec:wigner} for odd prime dimensions.
Informally, it can be considered as the maximal theory of magic $\Rmax = (\Fmax, \Omax)$, where free states have non-negative Wigner distributions and free operations completely preserve this property.\\ 

\ddd{Things we MUST emphasize:
\begin{enumerate}
\item Perhaps a nice lead-in question: ``What happens if we view stabiliser states as thermodynamic equilibrium states and magic as a form of free energy?''
\item We have found a scenario in which it is impossible to describe a thermodynamic structure using any entropic approach!
\item We can tackle more `physicsy' questions like: how much magic can be distilled via available operations with some given fixed-point structure? 
\item This allows a diagnostic on the kind of operations needed to do good distillation. I.e. what fixed point structure should they have?
\item We go beyond the concept of monotones and replace a monotone with a $\sigma$--fragment.
\item We can get both upper and lower bounds on magic distillation.
\end{enumerate}
}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage
\section{Preliminaries and definitions}
\label{sec:ps}

\subsection{Stabilizer Theory}\label{sec:so}

Let $\{\ket{k}\}_{k \in \mathbb{Z}_d}$ be the standard computational basis, defined over $\mathbb{Z}_d = \{ 0, 1, \dots,d-1 \}$, with $d$ an odd prime. 
Since the field has character $d$, addition and multiplication on the field are always considered modulo $d$.
The Hilbert space of any system associated with this scheme is $\cal{H}_d \coloneqq \spanv{\ket{k}: k \in \mathbb{Z}_d}$.

The generalised Pauli matrices $X, Z$ can be defined by their respective roles as shift and phase operators,
\begin{align}
    X \ket{k} &= \ket{k + 1} \label{eq:xpauli}\\
	Z \ket{k} &= \omega^k \ket{k}, \label{eq:zpauli}
\end{align}
where $\omega \coloneqq e^{2\pi i/d}$ is the $d$-th root of unity and addition is modulo $d$. The Hilbert space $\cal{H}_d$ is associated with a phase space $\cal{P}_d = \mathbb{Z}_d \times \mathbb{Z}_d$, where every point $\bmx \coloneqq (x, p)$ corresponds to a displacement operator, defined as
\begin{equation}\label{eq:ddef}
    D_{\bmx} \coloneqq \tau^{x p} X^{x} Z^{p},\ (x, p) \in \cal{P}_d.
\end{equation}
The phase factor $\tau \coloneqq -\omega^{1/2}$ ensures unitarity.
For a composite system with product dimension $d = d_1 \dots d_n$ and Hilbert space, $\cal{H}_d = \cal{H}_{d_1} \otimes \dots \otimes \cal{H}_{d_n}$, the displacement operators are defined as
\begin{equation}\label{eq:composited}
    D_{\bmx} \coloneqq D_{(x_1, p_1)} \otimes \dots \otimes D_{(x_n, p_n)},
\end{equation}
where 
\begin{align*}
	\bmx \coloneqq (x_1, p_1, x_2, p_2, \dots, x_n, p_n) \in \cal{P}_{d_1} \times \dots \times \cal{P}_{d_n} \eqqcolon  \cal{P}_d,
\end{align*}
denotes the phase space point for an $n$--copy system.

The displacement operators form the Heisenberg-Weyl group \nick{CITE} under matrix multiplication modulo phases,
\begin{equation}\label{eq:gp}
    {\rm{HW}}_d^n \coloneqq \{ \tau^k D_{\bmx}: k \in \mathbb{Z}_d, \bmx \in \cal{P}_d^n\}.
\end{equation}
The Clifford operations $ \cal{C}_d^n $ are then defined as the set of unitaries that normalise the Heisenberg-Weyl group. We may define the pure stabiliser states as those states obtained by acting on $|0\>$ with Clifford unitaries. Finally, we define $\stab$ as the convex hull of all pure stabiliser states, namely all probabilistic mixtures of states of the form $U|0\>\<0|U^\dagger$ where $U$ is some Clifford unitary. The stabiliser theory forms a magic resource theory $\R = (\stab, \so)$
and the free operations are stabiliser operations ($\so$), defined as compositions of preparation of computational basis states, Clifford unitaries, measurement in the computational basis, and the ability to discard subsystems.

\subsection{Wigner representations for quantum states and quantum operations}\label{sec:wigner}

We define the phase-point operators at every phase space point $\bmx \in \cal{P}_d$,
\begin{align}
	A_{\bmx} \coloneqq \frac{1}{d} \sum_{\bmz \in \cal{P}_d} \omega^{\eta(\bmx, \bmz)} D_{\bmz}, \label{eq:ax}
\end{align}
where $\eta(\bmx, \bmz)$ is the standard symplectic form, given explicitly by
\begin{equation}
	\eta(\bmx, \bmz) \coloneqq \bmz^T \begin{pmatrix}
		0  & \id \\ %\mathbbm{O}_n  & \id_n \\
		-\id & 0 \\ %-\id_n & \mathbbm{O}_n \\
	\end{pmatrix} \bmx,
\end{equation}
where $0, \id$ denote the $n\times n$ zero and identity matrices.

The phase-point operators form an orthogonal Hermitian operator basis as shown in~\cref{app:wigner}.
Therefore, any quantum state $\rho \in \cal{B}(\cal{H}_d)$ can be expressed as a linear combination of them,
\begin{equation}
    \rho = \sum_{\bmz \in \cal{P}_d} \W[\bmz]{\rho} A_{\bmz},
\end{equation}
where the coefficient vector $\W{\rho}$ is the Wigner distribution of state $\rho$,
\begin{equation}\label{eq:wstate}
    \W[\bmx]{\rho} \coloneqq \frac{1}{d}\tr[A_{\bmx} \rho].
\end{equation}

For any quantum state $\rho$, the Wigner distribution $W_\rho(\bmx)$ is readily seen to be a $d^2$-dimensional quasi-probability distribution over $\cal{P}_d$ (see~\cref{app:wigner} for details).  In~\cref{fig:wstate_examples}, we show Wigner distributions of different types of qutrit states.
\begin{figure}%
    \centering
    \subfigure[][]{%
    \label{fig:maxmix}%
    \includegraphics[height=2cm]{figs/maxmixed.pdf}
    %\caption{Maximally mixed state $\frac{1}{3}\id$}%
    }\hspace{8pt}%
    \subfigure[][]{%
    \label{fig:zero}%
    \includegraphics[height=2cm]{figs/zerostate.pdf}
    %\caption{Zero state $\ketbra{0}{0}$}%
    }\\
    \subfigure[][]{%
    \label{fig:bound}%
    \includegraphics[height=2cm]{figs/boundstate.pdf}
    %\caption{Bound state}%
    }\hspace{8pt}%
    \subfigure[][]{%
    \label{fig:strange}%
    \includegraphics[height=2cm]{figs/strangestate.pdf}
    %\caption{Strange state $\ketbra{S}{S}$}%
    }
    \caption{\textbf{Qutrit Wigner distributions of varying magic.} 
    \subref{fig:maxmix} Maximally mixed state $\frac{1}{3}\id$; \subref{fig:zero} Stabilizer zero state $\ketbra{0}{0}$; \subref{fig:bound} A non-stabiliser Wigner-positive state; \subref{fig:strange} Magic Strange state $\ket{{\rm{S}}} = \frac{1}{\sqrt{2}}(\ket{1} - \ket{2})$, coined in~\cite{cit:veitch2}.
    }%
    \label{fig:wstate_examples}
\end{figure}

We also have Wigner representations for general quantum channels. We may exploit the channel-state duality and use the normalised Choi-Jamio\l{}kowski state 
\begin{equation}\label{eq:cj}
  \J(\E) \coloneqq \frac{1}{d_A}(\id \otimes \E) \sum_{i,j} \ket{ii}\bra{jj}
\end{equation}
to extend the definition of the Wigner distribution to a quantum channel $\E: \B(\H_A) \rightarrow \B(\H_B)$, via the expression
\begin{align}\label{eq:woperation}
    \W[\bmy|\bmx]{\E} 
    &\coloneqq d_A^2 \W[\bm{\bar x} \oplus \bmy]{\J(\E)} \\
    &= \frac{1}{d_B} \tr_B[A_{\bmy} \E(A_{\bmx})],
\end{align}
where $\bm{\bar x} \coloneqq (x, -p)$.

The specific form of~\cref{eq:woperation} is chosen so that Wigner distributions of operations act as transition matrices for Wigner distributions of states, $\W{\E(\rho)} = \W{\E}\W{\rho}$.
In particular, $\cptp$ operations that map between density operators of equal dimensions and have non-negative Wigner distributions correspond to stochastic matrices, as shown in~\cref{app:wigner}

\subsection{Magic monotones}
\label{sec:mono}

We highlight the defining property of a monotone, as it is useful in later discussion.
\begin{definition}[\textbf{Resource monotone}]\label{def:mono}
    Let $\R = (\F, \O)$ be a resource theory.
    A resource monotone $\M$ is a projection from the set of quantum states of the theory onto the real line, so that $\M$ is monotonically decreasing under free operations,
    \begin{equation}
        \M(\rho_1) \leq \M(\rho_2)\ \text{whenever}\ \rho_1 \prec_{\R} \rho_2.
    \end{equation}
\end{definition}

\nick{We can skip mana and just discuss sum-negativity}
One of the most fundamental and commonly used magic monotones is the \emph{mana} of a state~\cite{cit:veitch2}, defined as
\begin{equation}
    \mana{\rho} \coloneqq \ln{(2\hspace{1pt}\sn{\rho}+1)},
\end{equation}
where the \emph{sum-negativity} ($\rm{sn}$)~\cite{cit:veitch2} is the sum of the negative components in $\W{\rho}$,
\begin{equation}
    \sn{\rho} \coloneqq \sum\limits_{\bmx: \W[\bmx]{\rho} < 0} \abs{\W[\bmx]{\rho}}.
\end{equation}
Mana is an additive\footnote{It satisfies the condition $\mana{\rho_1 \otimes \rho_2} = \mana{\rho_1} + \mana{\rho_2}$ which is practical in distillation settings.} magic monotone, so it provides an analytical, necessary condition for many-copy magic state interconvertibility.

\subsection{Majorisation}
\label{sec:major}

Majorisation is a collection of powerful tools that has recently found many applications in quantum information theory \nick{CITE}.
It describes the \nick{disorder / non-uniformity} of distributions that undergo stochastic transformations.

To formally state majorisation results, we first denote by $\stoch$ the set of $(d \times d)$ stochastic matrices that preserve the probability vector $\bmd$.
Specifically, for any $S \in \stoch$, all matrix elements are non-negative, all rows sum to $1$ and $S\bmd = \bmd$.
The set $\stoch$ forms a group under matrix multiplication for all $\bmd$ with positive components.

Majorisation describes quantum thermodynamics exactly in the absence of quantum coherence.
The use of majorisation in this setting provides vital intuition for our purposes.
At any given temperature $\beta^{-1}$, the thermal state $\gamma_\beta$ is thermodynamically the most disordered state. 
Thermal operations are defined as operations that cannot extract energy from the Gibbs state, $\E(\gamma_\beta) = \gamma_\beta$.
Convertibility between states via thermal operations is equivalent to a stochasticity condition on the energy level populations of the states \nick{CITE}.
Informally, there exists a thermal operation $\E$ such that $\tau = \E(\rho)$ if and only if there exists a matrix $S \in \stoch$ such that $\bm{q} = S\bm{p}$, where $\bm{q}, \bm{p}$ and $\bmd$ and the energy level population vectors of $\tau, \rho, \gamma_\beta$ respectively.
Formal statements of the above can be found \nick{in the appendix}.

Based on this setting, we define majorisation as follows.
\begin{definition}[\textbf{$\boldsymbol\bmd$-majorisation}]\label{def:dmajor}
    Given $\bmx, \bmy, \bmd \in \reals^d$, such that the components of $\bmd$ are positive, $\bmy$ is said to $\bmd$-majorise $\bmx$, iff there exists a matrix $S \in \stoch$ such that $\bmx = S\bmy$.
\end{definition}
We denote this pre-order by $\bmx \prec_{\bmd} \bmy$.
If $\bmd = \frac{1}{d}\bm{1}$, the $d$-dimensional uniform distribution, then $\stoch$ is the set of doubly stochastic matrices and we retrieve the familiar notion of majorisation from entanglement theory. \nick{CITE}

The pre-order imposed by $\bmd$-majorisation admits a numerically efficient reformulation in terms of Lorenz curves.
Let the vector $\bmu^\downarrow$ denote the vector $\bmu \in \reals^d$ with its components arranged in non-increasing order.
\begin{definition}[\textbf{Lorenz curve}]\label{def:lc}
    Let $\bmw, \bmd \in \reals^d$, where the components of $\bmd$ are positive with $D = \sum_{i=1}^d d_i$ and denote by $\widetilde{\bmw} \coloneqq (w_1/d_1, \dots, w_d/\nick{d_d})^T$ the vector of ratios between the corresponding components of $\bmw$ and $\bmd$.
    
    Finally, denote by $\pi: \mathbb{Z}_d \mapsto \mathbb{Z}_d$ the permutation that sorts $\widetilde{\bmw}$, $(\widetilde{\bmw}^\downarrow)_i = w_{\pi(i)}$ for all $i=1,\dots,d$.
    
    Consider the piecewise linear curve obtained by joining the points $\{(0,0)\} \cup \{ (x_k, \lc{\bmw}{\bmd}(k)) \}_{k=1,\dots,d}$, where
    \begin{equation}\label{eq:lorenz}
        (x_k, \lc{\bmw}{\bmd}(k)) \coloneqq \left( \frac{1}{D}\sum_{i=1}^k d_{\pi(i)}, \sum_{i=1}^k w_{\pi(i)} \right).
    \end{equation}
    We define the set of points on this curve, $\lc{\bmw}{\bmd}(x),\ x \in [0,1]$, as the \emph{Lorenz curve} of vector $\bmw$ with respect to $\bmd$.
\end{definition}
Components $x_k$ are rescaled by $D$ so that comparison of curves with unequal dimensions is possible.
In fact, the Lorenz curves $\lc{\bmw}{\bmd}$ and $\lc{\bmw \otimes \bmd}{\bmd \otimes \bmd}$, where $\otimes$ denotes the Kronecker product, are identical.
Furthermore, a Lorenz curve $\lc{\bmw}{\bmd}(x)$ is always concave in $x$, since it consists of $d$ line segments each with slope $(\widetilde{\bmw}^\downarrow)_i$ for $i=1,\dots,d$ which is non-increasing by definition.
Finally, the points on the interior of the Lorenz curve connecting line segments of different slopes are called \emph{elbows}.

A vector $\bmy$ is said to \emph{$\bmd$--majorise} another vector $\bmx$ if and only if the Lorenz curve $\lc{\bmy}{\bmd}$ lies above Lorenz curve $\lc{\bmx}{\bmd}$, thus reducing $\bmd$--majorisation into a finite set of inequalities.
\begin{theorem}\label{thm:dmajor}
    Let $\bmx, \bmy, \bmd \in \reals^d$, such that the components of $\bmd$ are positive. 
    Then, $\bmx \prec_{\bmd} \bmy$ if and only if $\lc{\bmx}{\bmd}(x) \leq \lc{\bmy}{\bmd}(x)$ for all $x \in [0,1]$ with strict equality at $x=1$.
\end{theorem}
A restatement of the theorem including more equivalent conditions and a proof are provided in~\cref{app:major}.
	

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Stochastic structure of magic theories}
\label{sec:struc}

\subsection{Magic fragments}\label{sec:magfrag}

Equipped with the definitions of the Wigner distribution in odd prime dimensions, we can formally recast the maximal magic theory $\Rmax$ into a stochasticity setting.
The free states correspond to proper probability distributions 
\begin{equation}
    \Fmax \coloneqq \{ \rho: \W[\bmx]{\rho} \geq 0 \text{ for all } \bmx \in \cal{P}_d\}
\end{equation}

The free operations should send the set of free states $\Fmax$ into itself and completely preserve the non-negativity of the states, in the sense that $\E \in \Omax$ iff $(\id_d \otimes \E ) \sigma \in \stab$ for all odd prime dimensions $d$ whenever $\sigma \in \Fmax$.
It is shown by Wang \textit{et al.}~\cite{cit:wang} that $\Omax$ coincides with the set of operations $\E$ with stochastic Wigner distributions, 
\begin{equation}
    \Omax = \{ \E: \W[\bmy|\bmx]{\E} \geq 0 \text{ for all } \bmx, \bmy \in \cal{P}_d\}.
\end{equation}

Every established magic theory $\R = (\F, \O)$ is a subtheory of $\Rmax$ in the sense that $\F \subseteq \Fmax$ and $\O \subseteq \Omax$, and as such it falls under this new stochasticity setting. 
For technical simplicity in what follows we assume that $\F$ is a closed set, and note that $\F_{\rm{ max}}$ is itself a closed set, since it is specified by a finite set of linear constraints of the form $\tr[ L\rho] \geq 0$ with operators $L \in \cal{B}(\cal{H})$ ensuring that the state is positive and Wigner-positive.


Given this context we now define the following key notion, that is central to our analysis.
\begin{definition}[\textbf{$\boldsymbol\sigma$-fragment}]\label{def:sigmafrag}
   Given a resource theory of magic $\R = (\F, \O)$, the \emph{$\sigma$--fragment of $\R$} is the resource theory $\R_\sigma = (\F_\sigma, \O_\sigma)$, where $\F_\sigma = \{\sigma\}$ and the free operations are restricted to the ones that leave $\sigma$ invariant,
    \begin{equation}
        \O_\sigma \coloneqq \{ \E \in \O: \E(\sigma) = \sigma \}.
    \end{equation}
\end{definition}

Note that $\F = \bigcup_{\sigma \in \F} \F_\sigma$ trivially.
With this basic notion defined, we now show that this union holds for free operations as well and therefore that any resource theory of magic can be faithfully subdivided into $\sigma$--fragments, in such a way that any problem of interconversion in the parent magic theory $\R$ can be analysed across the different fragments.

\begin{theorem}\label{thm:frag}
    Let $\R = (\F, \O)$ be a theory of magic.
    Every operation in $\O$ leaves at least one free state invariant,
  \begin{equation}
\O = \bigcup\limits_{\sigma \in \F} \O_\sigma.
\end{equation}
Therefore, $\rho \longrightarrow \tau$ in $\R$ if and only if $\rho \longrightarrow \tau$ in a $\sigma$--fragment of $\R$.
\end{theorem}
\begin{proof}
    Suppose $\E$ is in a $\sigma$--fragment $\O_\sigma$.
    Then it is also in $\O$, hence $\bigcup\limits_{\sigma \in \F} \O_\sigma \subseteq \O$. 
    
    Conversely, suppose $\E$ is in $\O$. 
    The free states are a closed set that is mapped one-to-one to a closed subset $\cal{S}$ of the $(d^2 - 1)$-dimensional probability simplex.
    $\cal{S}$ is convex, since any combination of free states is also free and the Wigner distribution is linear.
    Therefore, $\cal{S}$ is convex and compact as a closed convex subset of the bounded compact probability simplex.
    
    We can now view $\W{\E}$ as a stochastic, continuous mapping from $\cal{S}$ to itself, thus Brouwer's fixed point theorem \nick{CITE} implies that there exists a probability distribution $d_{\bmz}$ for some $ \bmz \in \cal{P}_d$ that is a fixed point of $\W{\E}$.
    This corresponds to a free state $\sigma \coloneqq \sum_{\bmz \in \cal{P}_d} d_{\bmz} A_{\bmz} \in \F$. 
    Therefore $\E \in \O_\sigma$, and so $\O = \bigcup\limits_{\sigma \in \F} \O_\sigma$. 
    
    The state interconversion result follows immediately.
\end{proof}
\begin{figure}[t]
    \centering
        \includegraphics[scale=0.3
        ]{figs/operations.pdf}
    \caption{\textbf{Decomposition of a magic theory $\R$ intro $\sigma$--fragments.} 
	Examples of magic theories ($\so$: Stabilizer operations, $\Omax$: Completely positive-Wigner-preserving operations, $\rcu$: Random Clifford Unitaries -- subclass of $\so$) involve operations denoted by the two yellow regions, with every other established magic theory  between them.
    We introduce $\sigma$--fragments $\O_\sigma$ defined for all free states $\sigma$ that cover $\Omax$. 
    Each $\O_\sigma$ is extensible to a set of stochastic maps outside the $\cptp$ operations.
    Within each $\sigma$--fragment $\bmd$-majorisation can be used allowing for an intricate, but tractable approach towards the study of magic state interconversion.
    }
    \label{fig:zoo}
\end{figure}

The zoo of all magic operation classes is summarised in ~\cref{fig:zoo}.
Completely positive-Wigner-preserving operations~\cite{cit:wang} form the maximal operation class $\Omax$.
This theory of magic is thus covered by $\sigma$--fragments exactly and every other magic theory is contained within this cover.
In particular, the stabiliser operations $\so$ are contained within $\Omax$.

Every  quantum circuit aiming at a given magic state conversion $\rho \longrightarrow \tau$ possesses certain symmetries according to~\cref{thm:frag} that allow us to study the conversion within only certain $\sigma$--fragments that reflect these symmetries.
As a simple example, the dephasing channel
\begin{equation}\label{eq:dephase}
	\Delta(\rho) = \sum_{k \in \mathbb{Z}_d} \ketbra{k}{k}\rho\ketbra{k}{k}
\end{equation}
removes coherent phases in the computational basis and therefore leaves exactly all mixtures of computational basis states invariant.
A noise channel consisting only of such dephasing operations can be fully analysed in the $\sigma$--fragments for the pure computational basis states $\sigma$. \nick{Have proven in appendix that we need to consider \emph{only} the pure stabiliser fragments - not mixed ones}

The subdivision of magic theories into $\sigma$--fragments is also powerful because the pre-order $\prec_{\R_\sigma}$ of every $\sigma$--fragment is described by well-behaved majorisation tools, as we establish in the rest of this section.

\subsection{Majorisation of quasi-probabilities in $\sigma$--fragments}\label{sec:major_frag}

We can approach any magic theory through a thermodynamic lens, and in doing so we are provided with valuable insights on the structure of the theory. 
Firstly, any free state, for example a stabiliser state, can be viewed as a thermal state $\gamma_\beta$.
Without loss of generality we can always write a quantum state $\sigma$ as a thermal state, $\sigma = \gamma_\beta \coloneqq \frac{1}{\Z_\beta} e^{-\beta H}$ for some $\beta \geq 0$ and Hamiltonian $H$ (either effective or actual)\footnote{Technicalities arise for the case where $\sigma$ is not full rank, but this can be still described via $ \beta \rightarrow 0$ limiting process.}.
We can also view the set of free operations $\O_\sigma$ as a counterpart of thermal operations, in the sense that any operation $\E$ in $\O_\sigma$ preserves state $\sigma$. 

It is then apparent that the pre-order $\prec_{\R_\sigma}$ between the operations in the $\sigma$--fragment follows the rules of $\bmd$-majorisation as outlined in~\cref{sec:major}.
In particular, the pre-order $\prec_{\R_\sigma}$ of the $\sigma$--fragment $\R_\sigma = (\F, \O_\sigma)$ between $d$-dimensional states corresponds to the majorisation pre-order $\prec_{\W{\sigma}}$ between their $d^2$-dimensional Wigner distributions.
For simplicity we shall merge the notation into $\prec_\sigma$, as there is little risk of confusion.

Note that the Wigner components of an $n$-copy state $\rho^{\otimes n}$ can be calculated directly from $\W{\rho}$ by convolution of the distribution with itself,
\begin{equation}
	\W{\rho^{\otimes n}} = \W{\rho}^{\otimes n},
\end{equation}
where $\otimes$ can be interpreted as the usual Kronecker product in the last expression.
We may use the vector notation $\bmw(\rho) = (w(\rho)_i)_{i=1,\dots,d^2}$ for the Wigner distribution, in which case we can express the Kronecker product as
\begin{equation}
	\W{\rho} \otimes \W{\rho} = (w(\rho)_i w(\rho)_j)_{i,j=1,\dots,d^2}.
\end{equation}
The correspondence between the phase space and pure vector representations of the Wigner distribuition is discussed more in~\cref{app:cmpairs}.

Furthermore, we restrict our analysis to $\sigma$--fragments, where $\sigma$ is full-rank.
This is justified as majorisation is continuous between fragments, in the sense that the pre-orders $\prec_\sigma$ and $\prec_{\sigma'}$ are equivalent for states $\sigma$ and $\sigma'$ which are $\epsilon$-close. \nick{CHECK}
Therefore, majorisation analysis is robust under imperfections in the experimental implementation of quantum operations.

In particular, we can always use common noise effects to approximate any $\sigma$--fragment where $\sigma$ is not full-rank by the $\sigma'$--fragment where $\sigma'$ is a noisy approximation of $\sigma$. 
For example, inducing depolarising noise, we can write $\sigma' = (1-\epsilon)\sigma + \epsilon\frac{1}{d}\id$, for some infinitesimal $\epsilon > 0$, so that $\sigma'$ is full-rank and arbitrarily close to $\sigma$.
Important examples of such $\sigma$--fragments include pure stabiliser states which are rank-$1$, e.g. the zero state depicted in~\cref{fig:zero}. 
Operations in such fragments include important stabiliser operations like the replacement channel, $\E(\rho) = \sigma$ for all states $\rho$.

\begin{theorem}\label{thm:sigmamajor}
    Let $\R = (\F, \O)$ be a theory of magic. If $\rho \longrightarrow \tau$  in $\R$ then  $\W{\tau} \prec_\sigma \W{\rho}$ within at least one $\sigma$--fragment.
\end{theorem}
\begin{proof}
Suppose we can convert $\rho$ into $\tau$ in the magic theory. 
Thus there is some $\O_\sigma$ and some $\E \in \O_\sigma$ such that $\E(\rho) = \tau$, and $\E(\sigma)=\sigma$. 
Therefore, the Wigner distribution of this free operation satisfies $\W{\E} \in \stochw$ and $\W{\E}\W{\rho} = \W{\tau}$. 
Since $\sigma$ is full-rank and free, its Wigner distribution is strictly positive in all components, so it directly follows from~\cref{def:dmajor} that $\W{\tau} \prec_{\sigma} \W{\rho}$.
\end{proof}

The result of~\cref{thm:sigmamajor} can be understood as an extension of the idea of a magic monotone, where we replace $\M(\tau) \leq \M(\rho)$ with $\W{\tau} \prec_\sigma \W{\rho}$. 
The physical difference between the two expressions is that the majorisation ordering occurs in a specific $\sigma$--fragment.
Therefore, majorisation constraints can be used to place upper bounds on magic state distillation in a way that allows one to incorporate the physics of the allowed operations -- specifically, it enables us to bound how much magic can be distilled via quantum operations that, for example, preserve the equilibrium state of the system, or via operations that are symmetric about the $Z$-axis of the Bloch sphere.
We discuss distillation upper bounds in detail in~\cref{sec:unital,sec:stab}

This approach can also provide \emph{lower bounds} on distillation, however now more structure about the specific free operations must be included. 
We briefly discuss distillation lower bounds in~\nick{REF}.

\nick{Mention relative majorisation as a possibility}

\subsection{Lorenz curves of quasi-probabilities in $\sigma$--fragments}

It is straightforward to construct Lorenz curves for Wigner distributions in any $\sigma$--fragment.
As we have seen in~\cref{thm:sigmamajor}, for any full-rank free state $\sigma$ we have that $\W{\sigma}$ is a strictly positive full-rank probability distribution, and so one can define a corresponding notion of $d$--majorisation on \emph{quasi}--distributions.
We write $\lc{\rho}{\sigma}(x)$ for the Lorenz curve of $\W{\rho}$ with respect to $\W{\sigma}$.
The vector of ratios $\widetilde{\bmw}(\rho|\sigma)$ used to construct the curve is
\begin{equation}
	\widetilde{w}(\rho|\sigma)_i \coloneqq \frac{w(\rho)_i}{w(\sigma)_i},
\end{equation}
and is called the \emph{rescaled} distribution of $\rho$ with respect to $\sigma$.

An example of comparison between different Lorenz curves is provided in~\cref{fig:lctoy}.
The curves in the figure are constructed in the \emph{unital fragment}, i.e. the $\sigma$--fragment defined by the maximally mixed state $\sigma = \frac{1}{d}\id$ whose Wigner distribution is the uniform probability distribution.
\begin{figure}
    \centering
    \includegraphics[height=5cm]{figs/lctoy.pdf}
    \caption{\textbf{Quasi-probability Lorenz curve comparison}.
    The Lorenz curves are constructed by the Wigner distributions illustrated in~\cref{fig:wstate_examples} in the unital fragment $\O_{\id/d}$ for $d=3$.
    The maximally mixed state curve is simply the line connecting $(0,0)$ and $(1,1)$.
    There is no operation in $\O_{\id/d}$ that can convert $\ket{\rm{S}}$ to $\ket{0}$, as their Lorenz curves intersect.
    }
    \label{fig:lctoy}
\end{figure}

Normalisation of the Wigner distribution \nick{REF} ensures that for all quantum states $\rho$, $\lc{\rho}{\sigma}(x) \geq 0$ and $\lc{\rho}{\sigma}(1) = 1$.
We stress that $0 \leq \lc{\rho}{\sigma}(x) \leq 1$ for all $x \in [0,1]$ if and only if $\rho$ is a positive Wigner state.
As a consequence, checking whether a magic state conversion of the form
\begin{equation}\label{eq:sigma_conv}
	\rho \xrightarrow{\E \in \O_\sigma} \tau
\end{equation} 
is not possible, reduces to the set of constraints
\begin{equation}\label{eq:majbound}
    \lc{\rho}{\sigma}(x) \geq \lc{\tau}{\sigma}(x),\ x\in [0,1],
\end{equation}
due to~\cref{thm:sigmamajor,thm:dmajor}.

We can refine the number of independent constraints stemming from this inequality. 
In fact, there are only as many independent constraints as there are elbows in the Lorenz curve of the target state as shown in~\cref{app:lc_constraints}.
However, in principle any one inequality defined at some location $x$ provides a valid constraint leading to some upper distillation bound, and the more locations one considers, the stricter the bound is.

The area $\A_\sigma(\rho)$ between the curve $L_{\rho|\sigma}$ and the line $y=1$ is a resource monotone in the $\sigma$--fragment. 
This is clear because for any state conversion like~\cref{eq:sigma_conv}, the Lorenz curve $L_{\tau|\sigma}$ is lower than $L_{\rho|\sigma}$, hence $\A_\sigma(\E(\rho)) \leq \A_\sigma(\rho)$.
The exact form of the monotone is given in~\cref{app:areamono}.
\nick{should we include the area? Have a look at~\cref{app:areamono}}

We can now show that the magic monotone of mana, and equivalently the sum-negativity of a quantum state, can be viewed as a feature of majorisation, and independent of the particular $\sigma$--fragment one works in.
In fact, our current setting makes it apparent that mana provides a weaker condition than majorisation for all magic state interconversions.

We first show that the Lorenz curve maximum of state $\rho$ is independent of the $\sigma$--fragment and directly related to its sum-negativity.
\begin{lemma}\label{lem:lcmax}
	Given a quantum state $\rho$, the maximum of its Lorenz curve $\lc{\rho}{\sigma}$ is independent of the $\sigma$--fragment and is equal to $1+\sn{\rho}$.
\end{lemma}
\begin{proof}
	We may use the vector notation of the Wigner distributions $\bmw(\rho)$ and $\bmw(\sigma)$.
	We choose the component indexing so that the rescaled distribution 
	\begin{equation}
		\widetilde{\bm{w}}(\rho|\sigma) \coloneqq \left(\frac{w(\rho)_1}{w(\sigma)_1}, \dots, \frac{w(\rho)_{d^2}}{w(\sigma)_{d^2}} \right)^T,
	\end{equation}
	is sorted, $\widetilde{\bm{w}} = \widetilde{\bm{w}}^\downarrow$.
	Note that all components of $\bmw(\sigma)$ are positive, so $\widetilde{w}_i \geq 0$ if and only if $w(\rho)_i \geq 0$ for any $i=1,\dots,d^2$.
	
	Let $i_\star$ be the index of the smallest non-negative component of $\widetilde{\bm{w}}^\downarrow$.
	Then, $w(\rho)_i < 0$ if and only if $i > i_\star$, so the maximum of Lorenz curve $\lc{\rho}{\sigma}(x)$ takes the value 
	\begin{equation}
		\lc{\rho}{\sigma}(x_{i_\star}) = \sum_{i=1}^{i_\star} w(\rho)_i,
	\end{equation}
	and is achieved at
	\begin{equation}\label{eq:maxloc}
		x_{i_\star} \coloneqq \sum_{i=1}^{i_\star} w(\sigma)_i.
	\end{equation}

	The location of the maximum ($x=x_{i_\star}$) varies from fragment to fragment, but its value is independent of $\sigma$,
	\begin{equation}
		\lc{\rho}{\sigma}(x_{i_\star})
		= \sum\limits_{\bmx: \W[\bmx]{\rho} \geq 0} \W[\bmx]{\rho}
		= 1 + \sn{\rho}.
	\end{equation}
	
\end{proof}

We can therefore view mana as just one feature of the Lorenz curve, namely its maximum value. 
Conversely, it is now clear that the maximum of the Lorenz curve acts as a valid magic monotone.
This implies the following result.
\begin{theorem}\label{thm:bounds}
    Given a magic state conversion $\rho \longrightarrow \tau$, the majorisation condition is stronger than the mana condition in every $\sigma$--fragment.
\end{theorem}
\begin{proof}
    The maximum of the Lorenz curve of a state $\rho$ is independent of the $\sigma$--fragment due to~\cref{lem:lcmax}, and can be expressed as an increasing function of mana,
    \begin{equation}
        \max_{x\in[0,1]}{\lc{\rho}{\sigma}(x)} = 1 + \sn{\rho} = \frac{1}{2} \left( 1 + e^\mana{\rho} \right).
    \end{equation}
    Therefore, the majorisation bound
    \begin{equation}
    	\lc{\rho}{\sigma}(x) \geq \lc{\tau}{\sigma}(x),\ x\in[0,1]
    \end{equation}
    implies the order $\max_{x\in[0,1]}{\lc{\rho}{\sigma}(x)} \geq \max_{x\in[0,1]}{\lc{\tau}{\sigma}(x)}$, hence the mana condition $\mana{\rho} \geq \mana{\tau}$.
\end{proof}

In sections~\cref{sec:unital,sec:stab}, we study majorisation constraints on magic distillation arising in different fragments. 
For this reason, we define the $n$-copy, $\epsilon$-noisy Strange state,
\begin{equation}\label{eq:noisysn}
    \rho_{\rm{S}}(\epsilon)^{\otimes n} \coloneqq \left[ (1 - \epsilon) \ket{\rm{S}}\bra{\rm{S}} + \epsilon \frac{1}{3}\id \right]^{\otimes n},
\end{equation}
in $\O_\sigma$, where the pure magic state $\ket{\rm{S}}$ is induced with depolarising noise. 
Its Wigner distribution is visualised in~\cref{fig:strange}.

At $\epsilon=0$, the Strange state is a qutrit magic state of maximal sum-negativity / mana~\cite{cit:veitch2} and therefore acts as an ideal distillation target, analogous to a Bell state in bipartite entanglement theory.
The Strange state is exceptionally symmetric under Clifford transformations and as a result there exists a \emph{twirling} protocol, discussed in detail in~\cite{cit:prakash,cit:prakash2}, allowing for the conversion of any noisy magic state to the form of~\cref{eq:noisysn} via Cliffords.

In~\cref{fig:lcs}, we illustrate the Lorenz curve $\lc{\rho_{\rm{S}}}{\sigma}$\footnote{Hereinafter, we may drop parameters $\epsilon$ and $n$ for clarity} of pure and noisy $n$-copy Strange states in some thermal $\sigma$--fragment.
Due to~\cref{lem:lcmax}, it is clear that the curves peak at $1 + \sn{\rho_{\rm{S}}(\epsilon)^{\otimes n}}$.
\begin{figure}
    \centering
    \includegraphics[height=5cm]{figs/lc_strange.pdf}
    \caption{\textbf{Strange state Lorenz curves.} Lorenz curves of $\rho_{\rm{S}}(\epsilon)^{\otimes n}$ for $n=1,2,3,4$ in the $\sigma$--fragment where $\sigma = e^{-\beta H}/\Z_{\beta}$, with Hamiltonian spectrum $(0,1,2)$ over the computational basis and $\beta = 0.5$.
    Solid lines represent pure Strange states ($\epsilon = 0$); dashed lines represent noisy Strange states ($\epsilon = 0.1$).
    }
    \label{fig:lcs}
\end{figure}

\section{Magic in the unital fragment}
\label{sec:unital}

The unital fragment encompasses the circuits which preserve the maximally mixed state ($\id/d$) and so it includes many important families of circuits.

MSD circuits in principle consist of bulk sequences of random Clifford unitaries ($\rcu$)\nick{CITE}, depicted in~\cref{fig:zoo}.
Operations in $\rcu$ can be expressed as
\begin{equation}
    \E(\rho) = \sum_i p_i U_i \rho U_i^\dagger,\ U_i \in \cal{C}_d.
\end{equation}
Depending on the symmetries of such operations, a Clifford sequence may belong in other $\sigma$--fragments as well.
In such a case, the majorisation condition~(\ref{eq:majbound}) needs to be checked in the $\sigma$--fragments that reflect all symmetries of the operation sequence.

In general, noisy circuits are well-described by the unital fragment.
To see this, consider incorporating noisy channels in the circuit, for example dephasing channels as in~\cref{eq:dephase} defined in different bases.
This process destroys the circuit symmetries, except for the invariance of the maximally mixed state.
Dephasing and bit-flip error channels are examples of the many error-inducing channels that respect the unital symmetry. \nick{Expand on significance of unital fragment}

We now consider the task of purifying $n$ copies of a noisy Strange state $\rho_{\rm{S}}(\epsilon)^{\otimes n}$ as given in~\cref{eq:noisysn} into a smaller number of copies $n'$ of a less noisy strange state $\rho_{\rm{S}}(\epsilon')^{\otimes n'}$, with $\epsilon' < \epsilon$ and $n' \leq n$,
\begin{equation}\label{eq:sudist}
	\rho_{\rm{S}}(\epsilon)^{\otimes n} \longrightarrow \rho_{\rm{S}}(\epsilon')^{\otimes n'} \otimes \left( \frac{1}{3}\id \right)^{\otimes (n-n')},
\end{equation}
where all copies $n, n', n - n'$ are even.
Since the state $\id / 3$ is free, tensoring in copies of it does not affect the distillation process.

The Lorenz curve $\lc{\rho_{\rm{S}}}{\id/3}$, for some general noise parameter $\epsilon$ and number of copies $n$, is defined at $9^n$ points between $0$ and $1$.
The exact expressions for the coordinates of these points can take $8$ different forms, depending on whether the noise level \nick{noise level / error rate} $\epsilon$ is greater or less than $\frac{3}{7}$, the parity of the number of copies $n$ is even or odd and the location relative to the curve peak is on the left hand side (LHS -- including the curve peak) or right hand side (RHS) of the curve peak.
The full details for the construction of all Lorenz curve forms are provided in~\cref{app:lcsu_technical}.

\nick{In the following, should we talk about the coordinates of all elbows and then say that we are gonna use only the first elbow, or should we leave full-elbow analysis for the appendix and only talk about first elbow here?}

Here we focus on the case of Lorenz curves with even copies $n, n'$ and low noise levels ($\epsilon' < \epsilon \leq 3/7$).
The part of the curve on the LHS of its peak is constructed by the positive components of the state Wigner distribution that take values $w_i$, with associated multiplicities $m_i$,
\begin{align}
	w_i &= \left( \frac{1}{6} - \frac{1}{18}\epsilon \right)^{2i}\left( -\frac{1}{3} + \frac{4}{9}\epsilon \right)^{n-2i}, \\
	m_i &= 8^{2i}\binom{n}{2i},
\end{align}
where $i=0,\dots,\frac{n}{2}$.
It is readily seen that $\lc{\rho_{\rm{S}}}{\id/3}(x)$ has elbows on the LHS of its peak located at points $x=x_i$, where
\begin{equation}
	x_i = \Phi_+ \left( 2i; n , \frac{8}{9} \right),
\end{equation}
with $i = 0,1, \dots , n$ and where $\Phi_+(i,n,p)$ is an even-power cumulant distribution function given by
\begin{equation}
	\Phi_+(2i; n, p) \coloneqq \sum_{\ell=0}^{i} \binom{n}{2\ell} p ^{2\ell} (1-p)^{n-2\ell}.
\end{equation}
We provide technical details on the function $\Phi_+$ in the appendices.

The value of the Lorenz curve at an elbow is given by
\begin{equation}
	\lc{\rho}{\id/3}(x_{i}) \equiv L_{i} =  \left( \frac{5}{3} - \frac{8}{9}\epsilon\ \right)^{n} \Phi_+\left(2i;n,\frac{12-4\epsilon}{15-8\epsilon}\right),
\end{equation}
and we define $(x_{-1}, L_{-1}) = (0,0)$.

\iffalse
The coordinates of any point on the Lorenz curve LHS can be expressed as convex sums of the neighbouring elbows,
\begin{align}
    x_{ijk} &= \left( 1-p_{ijk}\right) x_{i-1} + p_{ijk} x_{i} \label{eq:lcsu_xcoord}\\
    L_{ijk} &= \left( 1-p_{ijk} \right) L_{i-1} + p_{ijk} L_{i}, \label{eq:lcsu_lcoord}
\end{align}
where we use a three-index parametrisation for the coordinates, with $i$ the index of the elbow that follows, $j = 1,\dots,m_i$ and $k=1,\dots,9^{2(n-n')}$.
Therefore, for the initial state $\rho_{\rm{S}}^{\otimes 2n}$ we have
\begin{equation}
	p_{ijk} = \frac{j}{8^{2i}\binom{2n}{2i}},
\end{equation}
with $i=0,\dots,n,\ j(i) = 1,\dots,8^{2i}\binom{2n}{2i}$ and $k = 1$.
For the target state $\rho_{\rm{S}}(\epsilon')^{\otimes 2n'} \otimes \left( \frac{1}{3}\id \right)^{\otimes 2(n-n')}$,
\begin{equation}
	p'_{i'j'k'} = \frac{k' + (j'-1)9^{2(n-n')}}{9^{2(n-n')} 8^{2i'}\binom{2n'}{2i'}}
\end{equation}
with $i'=0,\dots,n',\ j'(i') = 1,\dots,8^{2i'}\binom{n'}{2i'}$ and $k' = 1,\dots,9^{2(n-n')}$.
\fi

Lorenz curve comparison provides $9^n$ necessary constraints for the process~\cref{eq:sudist}.
\cref{thm:elbows} shows that they can be reduced to $n'$ independent constraints.
However, in principle we can pick any location $x_\star \in [0,1]$ at which the Lorenz curves are defined and we then get a necessary distillation constraint, 
\begin{equation}
	\lc{\rho_{\rm{S}}(n, \epsilon, 0)}{\frac{\id}{3}}(x_\star) \geq \lc{\rho_{\rm{S}}(n', \epsilon', n-n')}{\frac{\id}{3}}(x_\star).
\end{equation}

We choose $x_\star = x_0 = \Phi_+(0, n, \frac{8}{9}) = \frac{1}{9^{n}}$, the location of the first elbow of the initial state $\rho_{\rm{S}}(n, \epsilon, 0)$.
The initial state Lorenz curve coordinate at this location is
\begin{equation}
	L_\star = L_0 = \left( \frac{5}{3} - \frac{8}{9}\epsilon\ \right)^{n} \Phi_+\left(0;n,\frac{12-4\epsilon}{15-8\epsilon}\right) = \left(\frac{3-4\epsilon}{9}\right)^n
\end{equation}

The first elbow of the target state is located at $x'_0 = \frac{1}{9^{n'}} > x_\star$, so in order to find the target state Lorenz curve coordinate $L'_\star$ at location $x_\star$, we can interpolate between the origin and the first target state elbow, 
\begin{equation}\label{eq:constraint_deriv}
	\begin{split}
	L'_\star &= \frac{x_\star}{x'_0}L'_0 = \frac{1}{9^{n-n'}}\left( \frac{5}{3} - \frac{8}{9}\epsilon'\ \right)^{n'}\Phi_+\left(0;n',\frac{12-4\epsilon'}{15-8\epsilon'}\right) \\
	&= \frac{(3-4\epsilon')^{n'}}{9^{n}}.
	\end{split}
\end{equation}
The process in~\cref{eq:sudist} is therefore possible only if $L_\star \geq L'_\star$ or equivalently,
\begin{align}
	\frac{n}{n'} &\geq \frac{\ln{(3-4\epsilon')}}{\ln{(3-4\epsilon)}}, \text{ or}\\
	\epsilon &\leq \frac{3}{4} - \frac{1}{4}(3-4\epsilon')^{\frac{n'}{n}}.
\end{align}
As an example, the process with $(n, n') = (12, 4)$ and $\epsilon' = 0.05$ yields $\epsilon \leq 0.398$.
Numerical comparison of the curves with varying $\epsilon$ suggests that we require $\epsilon \leq 0.373$ for the process to be possible.

Moreover, for the problem of distilling pure magic states where $\epsilon'=0$ we obtain an upper bound on the unital fragment distillation rate $R=n'/n$ given by
\begin{equation}
R \leq 1 + \frac{\ln (1 - \frac{4}{3} \epsilon)}{\ln 3},
\end{equation}
which holds for all finite $n$. 
In comparison, the bound from mana gives 
\begin{equation}
	R_{\rm{mana}} \leq 1 + \frac{\ln \left(1 - \frac{8}{15}\epsilon \right)}{\ln \frac{5}{3}},
\end{equation}
a threshold which is looser than the one provided by majorisation for all $\epsilon > 0$ as illustrated in~\cref{fig:distill_bounds}.
For example, for $\epsilon = 0.4$ we obtain $R\le 0.31 $ while the mana bound gives $R_{\rm{mana}} \le 0.53$.
\begin{figure}[t]
    \centering
    \includegraphics[scale=0.5]{figs/distill_bounds.pdf}
    \caption{\textbf{Distillation rate in unital fragment.} Distillation rates obtained by mana and majorisation are plotted for $\epsilon' = 0$, up to noise levels $\epsilon_{\rm{max}} = \frac{3}{7}$.
    Majorisation consistently provides stricter rates as proven in~\cref{thm:bounds}. \nick{add thauma?}
    }
    \label{fig:distill_bounds}
\end{figure}

\section{Magic bounds in arbitrary stabiliser fragments}
\label{sec:stab}

We now generalise the approach taken in the previous section and consider bounds on magic distillation for an arbitrary stabiliser fragment, $\R_\sigma$ where $\sigma$ is any quantum state $\sigma \in \stab$.
In other words, we consider those bounds on distillation that apply when the free operations have $\sigma$ as a fixed point.

These bounds can be interpreted in two different ways: on one hand they can be viewed as a family of upper bounds parameterized by a stabiliser state $\sigma$, on the other we can associate $\sigma$ to actual hardware limitations or to biased noise models in which it is an equilibrium state of some kind. 
Without loss of generality, we can always write a stabiliser state $\sigma$ as a Gibbs state $\sigma = \gamma_\beta \coloneqq \frac{1}{\Z_\beta} e^{-\beta H}$ for some $\beta \geq 0$ and Hamiltonian $H$ as discussed in~\cref{sec:major_frag}.

We focus on the distillation process
\begin{equation}\label{eq:stdist}
	\rho_{\rm{S}}(\epsilon)^{\otimes n} \longrightarrow \rho_{\rm{S}}(\epsilon')^{\otimes n'} \otimes \sigma^{\otimes (n-n')},
\end{equation}
where the noisy Strange state is given in~\cref{eq:noisysn} and we highlight again that any magic state can be transformed to this form via Clifford operations.
Notice that tensoring in copies of $\gamma_\beta$ does not affect the process, since the state is free.
In the following result, all copies $n, n', n - n'$ are even with $n > n'$, and $\epsilon'=0$, but the bounds are easily generalised to odd numbers of copies and $\epsilon'$ such that $0 < \epsilon' < \epsilon$. 
Finally, we assume a range of initial noise levels, $\epsilon \leq 3/7$, so that the largest Wigner component of the 1-copy noisy magic state is negative.
The numerical value of $3/7$ is higher than corresponding values of relevant existing distillation protocol error thresholds~\cite{cit:bravyi,cit:prakash}.

Given this context, we now provide the following result on bounding the distillation rate $R = R(\epsilon, \epsilon', \beta) \coloneqq \frac{n'}{n}$ of the process in~\cref{eq:stdist}.
The bounds depend on the free energy $F_\beta$ of state $\sigma$,
\begin{equation}
	F_\beta \coloneqq \tr[H \sigma] - \beta^{-1}S(\sigma) = -\beta^{-1}\log{\Z_\beta},
\end{equation}
where the von Neumann entropy is $S(\sigma) \coloneqq -\tr[\sigma\log{\sigma}]$.

\begin{theorem}\label{thm:stab_bounds}
	Let $\sigma$ be a qutrit stabiliser state, given by $\sigma = \frac{1}{\Z} e^{-\beta H}$ with $H$ having eigenvalues $E_0 \le E_1 \le E_2$, and where $\beta$ is an (effective) inverse temperature for the state. 
We define
\begin{equation}
	\beta_\star \coloneqq \frac{1}{E_2 - E_0} \ln{2}
\end{equation}
and for $\beta \leq \beta_\star$, we define a threshold error rate
\begin{equation}
	\epsilon_{\star}(\beta) \coloneqq 3 - \dfrac{18}{8-e^{(E_2 - E_0)\beta}}.
\end{equation}
Then any distillation rate $R(\epsilon, \beta)$ in the $\sigma$--fragment of a magic theory is bounded as follows:\\
If $\beta \leq \beta_{\star}$ and $\epsilon  \leq \epsilon_{\star}$,
\begin{equation}
	R(\epsilon,\beta) \leq 1 + \frac{\ln{\left( 1 - \frac{4}{3}\epsilon \right)}}{\beta (E_0 - F_\beta)}.
\end{equation}
If $\beta \leq \beta_{\star}$ and $\epsilon_{\star} < \epsilon$, then
\begin{equation}
	R(\epsilon, \beta) \le 1 + \frac{\ln{\left(1-\frac{1}{3}\epsilon \right)} - (E_2 - E_0)(\beta_{\star} - \beta)}{\beta (E_0 - F_\beta)}.
\end{equation}
Otherwise if $\beta > \beta_{\star}$,
\begin{equation}
	R(\epsilon, \beta) \leq  1+ \frac{\ln{\left(1-\frac{1}{3}\epsilon \right)}}{-\ln{2} + \beta (E_2 - F_\beta)}.
\end{equation}
\end{theorem}
A few comments can be given on this result. 
Firstly, the specific numerical factors in $\epsilon_\star$ are a result of our choice of magic state. 
Secondly, these bounds are derived based on analysis of only a part of the Lorenz curves and can be improved via a finer analysis. 
This is apparent by simple numerical calculations on the entirety of the curves.
Specifically, the existing bounds follow by considering the dominant terms in the rescaled Wigner distribution and do not, for example, take into account the Lorenz curve's peak structure. 
Finally, it is striking that we obtain a Landauer-like condition with a characteristic temperature $kT_\star \ln 2 = E_2 - E_0$, where $kT_\star = \beta_\star^{-1}$. 
It is unclear whether this points to a generic feature that can be directly related to fundamental thermodynamic relations, such as the erasure cost of a single bit being $kT \ln 2$. 
Given that we work with qutrits this seems surprising, but does deserve further study.

\begin{figure}[t!]
    \centering
    \includegraphics[scale=0.55]{figs/rate_scatter.pdf}
    \caption{\textbf{Bounds on magic distillation rates $R(\epsilon, \beta)$ within stabiliser fragments.}
    The vertical dashed line is the `Landauer-like' temperature threshold $\beta_\star$ and the diagonal dashed curve corresponds to the noise threshold $\epsilon_\star (\beta)$ at every $\beta \leq \beta_\star$. The unital fragment corresponds to the $\beta =0 $ line.
    }
    \label{fig:rate_contour}
\end{figure}

\begin{proof}
	We provide an outline of the proof here, with all technical details included in~\cref{app:lcst_technical}.\\

The Wigner distribution of the $\epsilon$-noisy Strange state can be written as 
\begin{equation}
	\W[\bmx]{\rho_{\rm{S}}(\epsilon)} = (1-\epsilon)\W[\bmx]{\ketbra{\rm{S}}} + \epsilon\W[\bmx]{\frac{1}{3}\id},
\end{equation}
so we get positive components
\begin{equation}
	u(\epsilon) = \frac{1}{6} -\frac{1}{18}\epsilon
\end{equation}
at the 8 phase space points $\bmx \in \cal{P}_3 \setminus \{\bmo\}$ and a negative component
\begin{equation}
	- v(\epsilon) = - \left( \frac{1}{3} -\frac{4}{9}\epsilon \right)
\end{equation}
at the origin $\bmx = \bmo$.

Let $\displaystyle \sigma = e^{-\beta H} / \Z_\beta$ be a stabiliser state, where $\beta \geq 0$ and $H = E_0 \ketbra{0} + E_1 \ketbra{1} + E_2 \ketbra{2}$, with $E_k \geq 0$.
Its eigen-decomposition can be written as 
\begin{equation}
	\sigma = \frac{e^{-\beta E_0}}{\Z_\beta} \ketbra{\varphi_0} + \frac{e^{-\beta E_1}}{\Z_\beta} \ketbra{\varphi_1} + \frac{e^{-\beta E_2}}{\Z_\beta} \ketbra{\varphi_2},
\end{equation}
where $\{\ket{\varphi_k}\}$ are pure, orthonormal stabiliser states. 
Therefore, there exists a Clifford operation that maps $\sigma$ to $\gamma_\beta$, where 
\begin{equation}
\gamma_\beta = \frac{e^{-\beta E_0}}{\Z_\beta} \ketbra{0} + \frac{e^{-\beta E_1}}{\Z_\beta} \ketbra{1} + \frac{e^{-\beta E_2}}{\Z_\beta} \ketbra{2}.
\end{equation}
\nick{Prove this carefully}

This Clifford operation permutes the Hamiltonian eigenvalues on the phase space, so that the negative component of $\rho_S(\epsilon)$ can lie on the same point on the phase space as any of the eigenvalues.
For this reason, we impose no order between the eigenvalues, but simply choose $E_0$ as the eigenvalue that is associated with the state negativity and denote the highest energy by $E_{\rm{max}} \coloneqq \max{\{E_0, E_1, E_2\}}$.

The Wigner distribution of state $\gamma_\beta$ can be seen as the ensemble average of the distributions of the computational basis states,
\begin{align}
	\W[\bmx]{\gamma_\beta} &= \sum\limits_{k=0}^2 \frac{e^{-\beta E_k}}{\Z_\beta}\W[\bmx]{\ketbra{k}} \\
	&= \sum\limits_{k=0}^2 \frac{e^{-\beta E_k}}{\Z_\beta} \delta_{x_0, k} = \frac{e^{-\beta E_{x_0}}}{3\Z_\beta},
\end{align}
for all $\bmx \in \cal{P}_3$. 
All Wigner components are strictly positive, therefore the pre-order $\prec_{\gamma_\beta}$ is always well-defined.

Our aim is to obtain a distillation bound for~\cref{eq:stdist} which depends on variables $n, n', \epsilon, \epsilon'$ as well as $\beta$.
In the analysis that follows, we drop obvious variable dependencies for clarity.

We construct the Strange state rescaled distribution 
\begin{equation}
	\widetilde{\rm{W}}_{\rho_{\rm{S}}|\gamma}(\bmx) \coloneqq \frac{\W[\bmx]{\rho_{\rm{S}}}}{\W[\bmx]{\gamma}}.
\end{equation}
There are four distinct values of the rescaled distribution on the phase space, as illustrated in the phase space diagram in~\cref{fig:pd_split_thermal}.
\begin{figure}[h]
    \centering
    \includegraphics[scale=0.5]{figs/pd_split_thermal.pdf}
    \caption{\textbf{Qutrit phase space regions with different rescaled values.}
    The rescaled distribution attains a unique value in each of the four regions, given by $3\Z \times$ the value depicted in the region, according to~\cref{eq:bmw_rescaled}.
    }
    \label{fig:pd_split_thermal}
\end{figure}

The component values and multiplicities of the relevant distributions in the four distinct regions are summarised by the following component and multiplicity vectors,
\begin{align}
	\bmm &\coloneqq (1,2,3,3), \\
	\bmw(\rho_{\rm{S}}) &\coloneqq (-v, u, u, u), \\
	\bmw(\gamma) &\coloneqq \frac{1}{3\Z} \left( e^{-\beta E_0}, e^{-\beta E_0}, e^{-\beta E_1}, e^{-\beta E_2} \right), \\
	\bmw(\rho_{\rm{S}} | \gamma) &\coloneqq 3\Z \left( -v e^{\beta E_0}, u e^{\beta E_0}, u e^{\beta E_1}, u e^{\beta E_2} \right). \label{eq:bmw_rescaled}
\end{align}

Using this notation, the component values and multiplicities of the $n$-copy distributions can be readily provided by~\cref{lem:ncopycomponents} in~\cref{app:cmpairs}.
They are parametrised by three independent components $i,j,k$, with sum $\alpha \coloneqq i+j+k \leq n$.
Then, the $n$-copy multiplicity is given by
\begin{equation}
	m_{ijk} = \frac{n!}{i!j!k!(n-\alpha)!} 2^i 3^j 3^k,
\end{equation}
while the distribution values that correspond to the same index triplet $(i,j,k)$ are given by
\begin{align}
	w(\rho_{\rm{S}})_{ijk} &= (-v)^{n-\alpha} u^{\alpha}, \\
	w(\gamma)_{ijk} &= (3\Z)^{-n} e^{-\beta (n-\alpha)E_0} e^{-\beta ( i E_0 + j E_1 + k E_2 )}, \\
	w(\rho_{\rm{S}} | \gamma)_{ijk} &= (3\Z)^{n} (-v)^{n-\alpha} u^{\alpha} e^{\beta (n-\alpha)E_0} e^{\beta ( i E_0 + j E_1 + k E_2 )}.
\end{align}

In order to construct the $n$-copy Lorenz curve $\lc{\rho_{\rm{S}}^{\otimes n}}{\gamma}$ we need to sort the components of the $n$-copy rescaled distribution, $w(\rho_{\rm{S}} | \gamma)_{ijk}$ in decreasing order.
In particular, to find the coordinates of the first elbow $(x_0, L_0)$, we need to evaluate the maximum rescaled component,
\begin{align}
	&\bmw(\rho_{\rm{S}} | \gamma)_{\rm{max}} \coloneqq \label{eq:max_slope}\\
	&(3\Z)^{n} \max\limits_{i,j,k}\Big\{ (-v)^{n-\alpha} u^{\alpha} e^{\beta (n-\alpha)E_0} e^{\beta ( i E_0 + j E_1 + k E_2 )} \Big\}, \nonumber
\end{align}
where $0 \leq i,j,k \leq n$ and $\alpha \coloneqq i+j+k \leq n$.
Notice that for $0 \leq \epsilon \leq 3/7$, we have $v \geq u$. 
We assume that $n$ is even, so that we need the sum $\alpha = i+j+k$ to be even for the expression to be positive. 
The following analysis is similar if $n$ is chosen to be odd.

Given an even value for the sum $\alpha$, the term $v^{n-\alpha} u^{\alpha} e^{-\beta (n-\alpha)E_0}$ is fixed, so the expression is maximised by setting the coefficient of the highest energy $E_{\rm{max}}$ equal to $\alpha$.
Hence, we have
\begin{align}
	&\bmw(\rho_{\rm{S}} | \gamma)_{\rm{max}} = \nonumber\\
	&(3\Z)^{n} v^n e^{n\beta E_0}\max\limits_{\substack{\alpha = 0,2, \\ \dots,n-2,n}}{\Big\{ \left( \frac{u}{v} e^{\beta (E_{\rm{max}} - E_0)} \right)^{\alpha} \Big\}}.
\end{align}
If the expression $\frac{u}{v} e^{\beta (E_{\rm{max}} - E_0)}$ is less than $1$ then the maximum occurs at $\alpha=0$, otherwise the maximum occurs at $\alpha = n$. To determine this transition we set
\begin{equation}\label{eq:noise_transition}
	\frac{u(\epsilon)}{v(\epsilon)} e^{\beta (E_{\rm{max}} - E_0)} \coloneqq \frac{3-\epsilon}{6-8\epsilon} e^{\beta (E_{\rm{max}} - E_0)} = 1.
\end{equation}
We want to find in which cases there exists a threshold noise level $\epsilon_\star$ at which the transition in~\cref{eq:noise_transition} occurs.
If $E_{\rm{max}} = E_0$, namely if the state negativity lies in the same phase space region as the highest energy, this threshold is constant in temperature and given by $\epsilon_{\star} = 3/7$. 
Otherwise, there is a threshold temperature value $\beta_\star$ given by
\begin{equation}
	\beta_{\star} \coloneqq \frac{1}{E_{\rm{max}} - E_0} \ln2.
\end{equation}
Below the threshold, $0 \leq \beta \leq \beta_\star$, the transition is well defined and the threshold noise level at which it occurs is given by
\begin{equation}
	\epsilon_{\star}(\beta) := 3 - \dfrac{18}{8-e^{(E_{\rm{max}} - E_0)\beta}}.
\end{equation}
This encompasses the case $E_{\rm{max}} = E_0$.
For $\beta > \beta_\star$, we have
\begin{equation*}
	\frac{3-\epsilon}{6-8\epsilon} e^{\beta (E_{\rm{max}} - E_0)} > \frac{3-\epsilon}{6-8\epsilon} 2 \geq \frac{1}{2}2 = 1,
\end{equation*}
so there is no transition and we set $\epsilon_\star = 0$.

The maximum rescaled component can then be expressed as
\begin{equation*}
\bmw(\rho_{\rm{S}} | \gamma)_{\rm{max}} =
	\begin{cases}
		(3\Z)^{n} v^n e^{n\beta E_0}, &\epsilon \leq \epsilon_{\star},\ \hspace{30pt}\rm{(C1)}	\\
		(3\Z)^{n} u^n e^{n\beta E_{\rm{max}}}, &\epsilon > \epsilon_{\star}.\ \hspace{32pt}\rm{(C2)} 
	\end{cases}
\end{equation*}
Case $\rm{(C1)}$ corresponds to $(i,j,k) = (0,0,0)$, so the multiplicity is $m_{000} = 1$ and the corresponding Wigner components are $\bmw(\rho_{\rm{S}})_{000}, \bmw(\gamma)_{000}$. 
Case $\rm{(C2)}$ corresponds to
\begin{equation}
	(i,j,k) = 
	\begin{cases}
	(0,n,0), &\text{if } E_{\rm{max}} = E_1, \\
	(0,0,n), &\text{if } E_{\rm{max}} = E_2.
	\end{cases}
\end{equation}
and we have $E_{\rm{max}} = E_1$ ($E_{\rm{max}} = E_2$), so the multiplicity is $m_{0n0} = 3^n$ ($m_{00n} = 3^n$) and the corresponding Wigner components are $\bmw(\rho_{\rm{S}})_{0n0}, \bmw(\gamma)_{0n0}$ ($\bmw(\rho_{\rm{S}})_{00n}, \bmw(\gamma)_{00n}$).

The first elbow coordinate can finally be derived as
\begin{equation}\label{eq:first_elb_coords}
	(x_0, L_0) =
	\begin{cases}
		\left( \left(\dfrac{e^{-\beta E_0}}{3\Z_\beta}\right)^n, v^n \right), &\rm{(C1)}	\vspace{10pt}\\
		\left( \left(\dfrac{e^{-\beta E_{\rm{max}}}}{\Z_\beta}\right)^n, (3u)^n \right). &\rm{(C2)} 
	\end{cases}
\end{equation}
\null\\

A necessary distillation constraint for the process in~\cref{eq:stdist} can be defined at the location $x_\star = x_0$ of the initial state's first elbow,
\begin{equation}\label{eq:first_elbow_constraint}
	\lc{\rho_{\rm{S}}(\epsilon)^{\otimes n}}{\gamma_\beta}(x_\star) \geq \lc{\rho_{\rm{S}}(\epsilon')^{\otimes n'}}{\gamma_\beta}(x_\star).
\end{equation}

The Lorenz curves of the initial and target states may each be described by either $\rm{(C1)}$ or $\rm{(C2)}$, depending on the physical parameters $\epsilon, \epsilon', \beta$.
Specifically, we have three scenarios:
\begin{enumerate}
	\item $\rm{(C1)} \rightarrow \rm{(C1)}$ if $E_{\rm{max}} = E_0$ or $E_{\rm{max}} > E_0$, $\beta < \beta_{\star}$ and $\epsilon' < \epsilon  \leq \epsilon_{\star}$.
	\item $\rm{(C2)} \rightarrow \rm{(C1)}$ if $E_{\rm{max}} > E_0$, $\beta < \beta_{\star}$ and $\epsilon' \leq \epsilon_{\star} < \epsilon$.
	\item $\rm{(C2)} \rightarrow \rm{(C2)}$ if $E_{\rm{max}} > E_0$, $\beta < \beta_{\star}$ and $\epsilon_{\star} \leq \epsilon' < \epsilon$ or $E_{\rm{max}} > E_0$, $\beta \geq \beta_{\star}$.
\end{enumerate}
Note that $\rm{(C1)} \rightarrow \rm{(C2)}$ is impossible because it would imply $\beta < \beta_{\star}$ and $\epsilon \leq \epsilon_{\star} \leq \epsilon' < \epsilon$, a contradiction.

In all three scenarios, it is simple to check that the initial state's first elbow is always located to the left (closer to $0$) of the target state's first elbow, $x_0 \leq x_0'$, as proven in~\cref{app:first_elb_loc}.
The prime indicates target state coordinates.
We can thus find the target state Lorenz curve coordinate $L'_\star$ at location $x_\star = x_0$ by interpolating between the origin and the target state's first elbow, 
\begin{equation}\label{eq:constraint_deriv_temp}
	L'_\star = \frac{x_\star}{x'_0}L'_0.
\end{equation}
Condition~\cref{eq:first_elbow_constraint} reads that we need $L_0 = L_\star \geq L_\star'$. Therefore, restricting to the first elbow, the necessary distillation condition in~\cref{eq:first_elbow_constraint} simply becomes
\begin{equation}\label{eq:first_elb_bound}
	\frac{L_0}{x_0} \geq \frac{L_0'}{x_0'}.
\end{equation}
Involving more elbows gives stricter, but more convoluted necessary distillation constraints.

We are now in a position to compute analytical distillation bounds for the distillation rate $R = R(\epsilon, \epsilon', \beta) \coloneqq n'/n$, based on the first elbow constraint for all three possible scenarios.
Substituting coordinates from~\cref{eq:first_elb_coords} appropriately in~\cref{eq:first_elb_bound}, we get the following necessary conditions:
\begin{enumerate}
	\item $\rm{(C1)} \rightarrow \rm{(C1)}$.
	
\begin{align}
	R \leq \frac{\ln{\big( 1-\frac{4}{3}\epsilon \big)} + \beta (E_0 - F_\beta)}{\ln{\big( 1-\frac{4}{3}\epsilon' \big)} + \beta (E_0 - F_\beta)}.
\end{align}
Equivalently, we require
\begin{align}
	\epsilon \leq \frac{3}{4} - \frac{3}{4} \left( 1 - \frac{4}{3}\epsilon' \right)^{R} \left( \frac{e^{-\beta E_0}}{\Z_\beta} \right)^{1 - R}	.
\end{align}
	
	\item $\rm{(C2)} \rightarrow \rm{(C1)}$ if $E_{\rm{max}} > E_0$, $\beta < \beta_{\star}$ and $\epsilon' \leq \epsilon_{\star} < \epsilon$.
	
\begin{align}
	R \leq \frac{\ln{\big( \frac{1}{2}-\frac{1}{6}\epsilon \big)} + \beta (E_{\rm{max}} - F_\beta)}{\ln{\big( 1-\frac{4}{3}\epsilon' \big)} + \beta (E_0 - F_\beta)}
\end{align}
Equivalently, we require
\begin{align}
	\epsilon &\leq 3 - 6 \left( 1 - \frac{4}{3}\epsilon' \right)^{R} \frac{e^{-\beta E_{\rm{max}}} e^{R\beta E_0}}{\Z_\beta^{1-R}}	
\end{align}

	\item $\rm{(C2)} \rightarrow \rm{(C2)}$ if $E_{\rm{max}} > E_0$, $\beta \geq \beta_{\star}$.
	
\begin{align}
	R \leq \frac{\ln{\big( \frac{1}{2}-\frac{1}{6}\epsilon \big)} + \beta (E_{\rm{max}} - F_\beta)}{\ln{\big( \frac{1}{2}-\frac{1}{6}\epsilon' \big)} + \beta (E_{\rm{max}} - F_\beta)}
\end{align}
Equivalently, we require
\begin{align}
	\epsilon &\leq 3 - 6 \left( \frac{1}{2} - \frac{1}{6}\epsilon' \right)^{R} \left( \frac{e^{-\beta E_{\rm{max}}}}{\Z_\beta} \right)^{1 - R}.
\end{align}
\end{enumerate}

Substituting $\epsilon' = 0$ leads to the expressions of the theorem statement.

\end{proof}

\null\newpage
\section{Comparison with existing distillation rates}
\label{sec:comparison}

We have derived a \emph{distillation bound} $R(\epsilon, \epsilon', \beta)$ for the process
\begin{equation}\label{eq:stdist}
	\rho_{\rm{S}}(\epsilon)^{\otimes n} \longrightarrow \rho_{\rm{S}}(\epsilon')^{\otimes n'} \otimes \gamma_\beta^{\otimes (n-n')},
\end{equation}
with even $n, n'$ and $0 \leq \epsilon' < \epsilon \leq 3/7$, where the $n$-copy, $\epsilon$-noisy Strange state is
\begin{equation}\label{eq:test}
    \rho_{\rm{S}}(\epsilon)^{\otimes n} \coloneqq \left[ (1 - \epsilon) \ket{\rm{S}}\bra{\rm{S}} + \epsilon \frac{1}{3}\id \right]^{\otimes n}.
\end{equation}

The bound informs us that any distillation protocol in the $\gamma_\beta$-fragment with an $\epsilon$-noisy input and $\epsilon'$-noisy output has a \emph{distillation rate} 
\begin{equation}
	\frac{n'}{n} \leq R(\epsilon, \epsilon', \beta).
\end{equation}

We apply our results on the ternary Golay code distillation protocol suggested in~\cite{cit:prakash}.
In this protocol, a single Strange state is distilled with noise level
\begin{equation}
	\epsilon'(n, \epsilon) \approx \frac{1}{\alpha}(\alpha\epsilon)^{n^\xi},
\end{equation}
where $\alpha \approx 1.75$ and $\xi \approx 0.112$ are constants specific to the protocol.
This can be rewritten in terms of the protocol distillation rate,
\begin{equation}
	R_{\rm{Golay}}(\epsilon, \epsilon') = \frac{1}{n} \approx \left( \frac{\log{(\alpha \epsilon)}}{\log{(\alpha \epsilon')}} \right)^{\frac{1}{\xi}}
\end{equation}

We compare the distillation rate of the protocol with our distillation bound, 
\begin{equation}
	R_{\rm{Golay}}(\epsilon, \epsilon') \leq R(\epsilon, \epsilon', \beta)
\end{equation} 
in figure~\cref{fig:prakash_compare}
\begin{figure}[h]
    \centering
    \includegraphics[scale=0.5]{figs/prakash_compare.png}
    \caption{\textbf{Comparison with ternary Golay distillation rate.}
    Our bound is not violated but gets close to saturated for some noise levels.
    The thick diagonal line indicates where $\epsilon' = \epsilon$.
    }
    \label{fig:prakash_compare}
\end{figure}

We can also rewrite the expression as 
\begin{equation}
	\epsilon_{\rm{Golay}}(\epsilon', n) \approx \frac{1}{\alpha}(\alpha\epsilon')^{n^{-\xi}},
\end{equation}
and compare with the numerically optimal error bounds provided by majorisation as shown in~\cref{fig:prakash_compare_errors}
\begin{figure}[h]
    \centering
    \includegraphics[scale=0.5]{figs/prakash_compare_errors.png}
    \caption{\textbf{Comparison with ternary Golay output error rate.}
    Our bound is not violated but achieves a maximum saturation of $\epsilon_\star - \epsilon_{\rm{Golay}} = 0.147$.
    }
    \label{fig:prakash_compare_errors}
\end{figure}

A recent distillation bound was introduced in~\cite{Seddon2020}, where they show that for the deterministic conversion of $n$ copies of a qubit state $\rho$ to a target pure magic state $\ket{\psi}$, the following bound on the distillation rate holds,
\begin{equation}\label{eq:seddon}
	\frac{n'}{n} \leq \frac{\log{\Lambda^+(\rho)}}{\log{F(\psi)^{-1}}},
\end{equation}
where $\Lambda^+(\rho)$ is the generalised robustness of state $\rho$, calculable via a costly SDP and $F(\psi)$ denotes the stabiliser fidelity of state $\ket{\psi}$.
They demonstrate the performance of their bound by considering the purification process of the qubit magic state $\ket{H}$, with their figure replicated in~\cref{fig:seddon}. 
For high initial noise level ($\epsilon = 0.25$), their bound dictates that $R = 1/150$, which is pretty good.
\begin{figure}[h]
    \centering
    \includegraphics[scale=0.3]{figs/seddon.png}
    \caption{\textbf{Comparison of Seddon \textit{et al.}'s bound~\cite{Seddon2020} in~\cref{eq:seddon} with a generic resource bound in~\cite{Fang2020}.}
    The process they consider is purifying $n$ copies of $(1-\epsilon)\ketbra{H} + \epsilon/3 \id$ to $n'$ copies of $(1-\epsilon')\ketbra{H} + \epsilon'/3 \id$.
    Their bound (red and blue) is pretty good compared with the generic (violet) bound.
    Not sure why it looks like their bound gives $n\rightarrow 25$ as $1-\epsilon \rightarrow 1$.
    }
    \label{fig:seddon}
\end{figure}

Similar concrete rates have been studied for qudits in two occasions:
First, the mana bound, which we have demonstrated in~\cref{fig:distill_bounds}.
Secondly, Wang \textit{et al.}'s max-thauma bound~\cite{Wang2020}, which as far as I can tell, is less tight than mana (?).
It is defined via an SDP, but we can use its properties (super-additivity and zero at free states) to readily get a bound on noisy Strange states,
\begin{equation}
	\theta_{\rm{max}}(\rho_{\rm{S}}(\epsilon)) \geq (1-\epsilon) \ketbra{\rm{S}} + \epsilon \frac{1}{3}\id = (1-\epsilon) \theta_{\rm{max}}(\rho_{\rm{S}}(0)).
\end{equation}
Their bound simply states that any deterministic single-copy distillation process $\rho^{\otimes n} \longrightarrow \tau$ requires an initial number of copies $n \geq \theta_{\rm{max}}(\tau) / \theta_{\rm{max}}(\rho)$.
Therefore, the rate of our pure Strange state distillation process~\cref{eq:sudist} can only get as tight as
\begin{equation}
	R = 1/n = \frac{\theta_{\rm{max}}(\rho_{\rm{S}}(\epsilon))}{\theta_{\rm{max}}(\rho_{\rm{S}}(0))} \leq 1-\epsilon,
\end{equation}
which is less tight than mana as could be readily observed if plotted in~\cref{fig:distill_bounds}.

\ddd{[Going forward:
\begin{enumerate}
\item Does the ``last elbow'' give the same bound? Is it as simple?
\item Numerically is this about as good as it gets from majorisation?
\item How does this rate compare with existing literature?
\end{enumerate}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Conclusion}
\label{sec:conc}

\begin{enumerate}
    \item Introduced fragments
    \item Identify symmetries of the setup
    \item Combined single-shot thermodynamics with magic 
    \item Can we solve other cases exactly? (apart from single qutrit)
\end{enumerate}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\bibliography{bib}
%\bibliographystyle{apsrev4-2}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\appendix
\input{appendix}

\end{document}